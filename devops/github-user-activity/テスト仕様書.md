## **単体テスト仕様書**

### **1. 目的**
- GitHub APIから取得したデータを正しく処理し、CLIに表示する機能の単体テストを行う。
- 異常系（APIのエラー、無効な入力）に対する正しいエラーハンドリングを確認する。

---

### **2. テスト対象**
- `fetch_github_activity()`関数:  
  - 引数として受け取ったGitHubユーザー名をもとにAPIを呼び出し、結果を解析してターミナル出力用のデータ構造を返す。
  
- `display_activity()`関数（例として分けた場合）:  
  - 上記データ構造を受け取り、フォーマットされた文字列をターミナルに表示する。

---

### **3. テスト環境**
- **言語:** Python 3.7+
- **ライブラリ:**  
  - `unittest`（標準ライブラリ）  
  - `unittest.mock`（API呼び出しのモックに使用）

---

### **4. テスト条件**

#### **正常系**
1. **入力:**  
   - 正しいGitHubユーザー名（例: `m-miyawaki-m`）  
   - 想定されるAPIレスポンス:  
     ```json
     [
         {"type": "PushEvent", "repo": {"name": "m-miyawaki-m/repo1"}, "payload": {"commits": [{"sha": "123", "message": "initial commit"}]}},
         {"type": "IssuesEvent", "repo": {"name": "m-miyawaki-m/repo2"}, "payload": {"action": "opened", "issue": {"title": "Fix bug"}}}
     ]
     ```
   
2. **期待結果:**  
   - ターミナルに以下のような出力が表示される:
     ```
     - repo1 に 1 コミットをプッシュしました
     - repo2 に新しいイシューをopenedしました: Fix bug
     ```

#### **異常系**
1. **無効なGitHubユーザー名**
   - **入力:** 存在しないユーザー名（例: `nonexistent_user`）  
   - **想定APIレスポンス:** 404エラー  
   - **期待結果:** 「ユーザーが見つかりません」とエラーメッセージを表示。
   
2. **ネットワークエラー**
   - **入力:** 正しいユーザー名（例: `m-miyawaki-m`）  
   - **想定APIレスポンス:** 接続エラー  
   - **期待結果:** 「ネットワークエラーが発生しました」と表示。
   
3. **レート制限エラー**
   - **入力:** 正しいユーザー名（例: `m-miyawaki-m`）  
   - **想定APIレスポンス:** 403ステータスコード + レート制限メッセージ  
   - **期待結果:** 「APIのレート制限に達しました」と表示。

---

### **5. テストケース一覧**

| テストID | シナリオ               | 入力                         | 期待結果                                        |
|----------|------------------------|------------------------------|------------------------------------------------|
| TC01     | 正常系 - PushEvent表示 | ユーザー名: `m-miyawaki-m`  | リポジトリ名とコミット数が正しく表示される      |
| TC02     | 正常系 - IssuesEvent表示 | ユーザー名: `m-miyawaki-m`  | イシュータイトルとアクションが正しく表示される  |
| TC03     | 異常系 - 404エラー      | ユーザー名: `nonexistent_user` | エラーメッセージ「ユーザーが見つかりません」が表示される |
| TC04     | 異常系 - 接続エラー      | ユーザー名: `m-miyawaki-m`  | エラーメッセージ「ネットワークエラーが発生しました」が表示される |
| TC05     | 異常系 - レート制限      | ユーザー名: `m-miyawaki-m`  | エラーメッセージ「APIのレート制限に達しました」が表示される |

---

## **単体テストチェックリスト**

1. **正常系**
   - [ ] 正しいユーザー名を入力した場合、APIレスポンスに基づいた結果が正しく出力される。
   - [ ] PushEventが適切に解析・表示される。
   - [ ] IssuesEventが適切に解析・表示される。

2. **異常系**
   - [ ] 存在しないユーザー名を指定した場合、適切なエラーメッセージが表示される。
   - [ ] APIの接続エラーが発生した場合、ユーザーに分かりやすいエラーメッセージが表示される。
   - [ ] APIのレート制限に達した場合、制限に関するエラーメッセージが表示される。

3. **その他**
   - [ ] 想定外のAPIレスポンス形式に対しても、スクリプトが適切にエラーメッセージを出力しクラッシュしない。
   - [ ] 標準ライブラリだけを使ってテストを行うことを確認する。

---